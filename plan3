# üöÄ –ü–ª–∞–Ω —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó "–†–æ–∑—É–º–Ω–æ–≥–æ –º–∞–ø–µ—Ä–∞ —ñ–Ω—Ç–µ–Ω—Ü—ñ–π" —á–µ—Ä–µ–∑ Gemini API

## üéØ –ú–µ—Ç–∞
–°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É, —è–∫–∞ —á–µ—Ä–µ–∑ Gemini API –∫–æ–Ω–≤–µ—Ä—Ç—É—î –≤—ñ–ª—å–Ω–∏–π —Ç–µ–∫—Å—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ñ —ñ–Ω—Ç–µ–Ω—Ü—ñ—ó –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, –∑–∞–º—ñ—Å—Ç—å –ø–æ—Ç–æ—á–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ—à—É–∫—É.

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞
```
User Input ‚Üí Gemini API ‚Üí Intent Normalizer ‚Üí Canvas View Dispatch ‚Üí Convex Data
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤

### 1. –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
- **–ü–∞–∫–µ—Ç**: `@google/generative-ai`
- **ENV**: `GEMINI_API_KEY`, `INTENT_MIN_CONFIDENCE`
- **–§–∞–π–ª**: `lib/ai/gemini.ts`

### 2. –ö–∞–Ω–æ–Ω—ñ—á–Ω—ñ —ñ–Ω—Ç–µ–Ω—Ü—ñ—ó
- **–§–∞–π–ª**: `lib/intents.ts`
- **–¢–∏–ø–∏**: `IntentName`, `INTENT_DEFS`
- **–Ü–Ω—Ç–µ–Ω—Ü—ñ—ó**: `show_invoices`, `open_invoice`, `top_debtors`, `create_invoice`

### 3. API Endpoint
- **–§–∞–π–ª**: `app/api/intent/route.ts`
- **–ú–µ—Ç–æ–¥**: `POST`
- **–§—É–Ω–∫—Ü—ñ—è**: –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–µ–∫—Å—Ç—É —á–µ—Ä–µ–∑ Gemini + –≤–∞–ª—ñ–¥–∞—Ü—ñ—è

### 4. –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ ChatDock
- **–§–∞–π–ª**: `components/chat/ChatDock.tsx`
- **–ó–º—ñ–Ω–∏**: `onSubmit` handler –¥–ª—è –≤–∏–∫–ª–∏–∫—É `/api/intent`
- **–õ–æ–≥—ñ–∫–∞**: Dispatch –ø–æ —ñ–Ω—Ç–µ–Ω—Ç–∞—Ö + –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è view'—ñ–≤

## üîß –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

### Gemini Prompt Engineering
- **–°–∏—Å—Ç–µ–º–Ω–∏–π –ø—Ä–æ–º–ø—Ç**: –î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –≤—Å—ñ—Ö —ñ–Ω—Ç–µ–Ω—Ü—ñ–π + –ø—Ä–∞–≤–∏–ª–∞
- **Few-shot examples**: –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ –¥–ª—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ
- **Temperature**: 0.2 –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—ñ
- **Response MIME**: `application/json`

### Intent Mapping
- **show_invoices**: `{ periodDays: number }`
- **open_invoice**: `{ businessId: string }`
- **top_debtors**: `{ limit: number }`
- **create_invoice**: `{ clientName, items, terms }`

### Fallback Handling
- **Confidence threshold**: –ó env (default 0.55)
- **Intent "none"**: –ö–æ–ª–∏ –Ω–µ –≤–ø–µ–≤–Ω–µ–Ω–∏–π
- **User tips**: –ü—ñ–¥–∫–∞–∑–∫–∏ —â–æ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏

## ‚úÖ –ß–µ–∫–ª—ñ—Å—Ç —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

### Phase 1: –ë–∞–∑–æ–≤–∞ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- [ ] –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ `@google/generative-ai`
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ `.env.local` –∑ API –∫–ª—é—á–µ–º
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ `lib/ai/gemini.ts`
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ `lib/intents.ts`

### Phase 2: API Endpoint
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ `app/api/intent/route.ts`
- [ ] –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Gemini –ø—Ä–æ–º–ø—Ç
- [ ] –î–æ–¥–∞—Ç–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é —Ç–∞ –æ–±—Ä–æ–±–∫—É –ø–æ–º–∏–ª–æ–∫
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ endpoint

### Phase 3: –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ UI
- [ ] –û–Ω–æ–≤–∏—Ç–∏ `ChatDock.onSubmit`
- [ ] –î–æ–¥–∞—Ç–∏ dispatch –ø–æ —ñ–Ω—Ç–µ–Ω—Ç–∞—Ö
- [ ] –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –∑ Canvas view'–∞–º–∏
- [ ] –î–æ–¥–∞—Ç–∏ fallback UX

### Phase 4: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è
- [ ] –¢–µ—Å—Ç—É–≤–∞—Ç–∏ –≤—Å—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ –∑ –ø—Ä–æ–º–ø—Ç—É
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ fallback —Å—Ü–µ–Ω–∞—Ä—ñ—ó
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –∑ —Ä–µ–∞–ª—å–Ω–∏–º Gemini API
- [ ] –í–∞–ª—ñ–¥—É–≤–∞—Ç–∏ –±–µ–∑–ø–µ–∫—É (API –∫–ª—é—á —Ç—ñ–ª—å–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ)

## üéâ –ü–µ—Ä–µ–≤–∞–≥–∏ –Ω–æ–≤–æ—ó –ª–æ–≥—ñ–∫–∏

1. **–†–æ–∑—É–º–Ω–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è**: "–ø–æ–∫–∞–∂–∏ —â–æ –Ω–∞–º –∑–∞–±–æ—Ä–≥—É–≤–∞–ª–∏" ‚Üí `top_debtors`
2. **–ì–Ω—É—á–∫—ñ—Å—Ç—å**: –†—ñ–∑–Ω—ñ —Ñ–æ—Ä–º—É–ª—é–≤–∞–Ω–Ω—è ‚Üí –æ–¥–Ω–∞ –¥—ñ—è
3. **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü—ñ—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è `periodDays`, `limit`
4. **Fallback**: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–≤–∂–¥–∏ –æ—Ç—Ä–∏–º—É—î –≤—ñ–¥–ø–æ–≤—ñ–¥—å
5. **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ —ñ–Ω—Ç–µ–Ω—Ü—ñ—ó

## ‚ö†Ô∏è –†–∏–∑–∏–∫–∏ —Ç–∞ –º—ñ—Ç–∏–≥–∞—Ü—ñ—è

- **API Latency**: Gemini –º–æ–∂–µ –±—É—Ç–∏ –ø–æ–≤—ñ–ª—å–Ω–∏–º ‚Üí –¥–æ–¥–∞—Ç–∏ loading state
- **Cost**: –ö–æ–∂–µ–Ω –∑–∞–ø–∏—Ç –∫–æ—à—Ç—É—î ‚Üí –¥–æ–¥–∞—Ç–∏ rate limiting
- **Fallback**: –Ø–∫—â–æ Gemini –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π ‚Üí fallback –Ω–∞ –ø–æ—Ç–æ—á–Ω—É –ª–æ–≥—ñ–∫—É
- **Security**: API –∫–ª—é—á —Ç—ñ–ª—å–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ ‚Üí –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ bundle

## üìä –û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü—ñ—Å–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–º–æ–∂–µ –ø–∏—Å–∞—Ç–∏:
- "–ø–æ–∫–∞–∂–∏ —Ä–∞—Ö—É–Ω–∫–∏ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 3 –º—ñ—Å—è—Ü—ñ" ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–∫—Ä–∏—î—Ç—å—Å—è —Ç–∞–±–ª–∏—Ü—è —ñ–Ω–≤–æ–π—Å—ñ–≤ –∑–∞ 90 –¥–Ω—ñ–≤
- "—Ö—Ç–æ –Ω–∞–º –Ω–∞–π–±—ñ–ª—å—à–µ –∑–∞–±–æ—Ä–≥—É–≤–∞–≤?" ‚Üí –≤—ñ–¥–∫—Ä–∏—î—Ç—å—Å—è –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞ –±–æ—Ä–∂–Ω–∏–∫—ñ–≤
- "—Å—Ç–≤–æ—Ä—ñ—Ç—å —Ä–∞—Ö—É–Ω–æ–∫ –¥–ª—è Acme –Ω–∞ 5 —Ç–æ–≤–∞—Ä—ñ–≤" ‚Üí –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è wizard —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è

**–¶–µ –∑–Ω–∞—á–Ω–æ –ø–æ–∫—Ä–∞—â–∏—Ç—å UX —Ç–∞ –∑—Ä–æ–±–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –±—ñ–ª—å—à —ñ–Ω—Ç—É—ó—Ç–∏–≤–Ω–æ—é!** üéØ

## üîó –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π –ø—Ä–æ–º–ø—Ç
–¶–µ–π –ø–ª–∞–Ω —Å—Ç–≤–æ—Ä–µ–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç—É –¥–ª—è Cursor IDE, —è–∫–∏–π –æ–ø–∏—Å—É—î –ø–æ–≤–Ω—É —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—é Intent Normalizer —á–µ—Ä–µ–∑ Gemini API.
